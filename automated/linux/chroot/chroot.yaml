metadata:
    name: ltp
    format: "Lava-Test-Shell Test Definition 1.0"
    description: "Run a chroot"
    maintainer:
        - anders.roxell@linaro.org
        - chase.qi@linaro.org
    os:
        - OE
    scope:
        - functional
    devices:
        - qemu-arm64
params:
    #Parameters that is here for the chroot
    ARM32_ROOTFS: https://snapshots.linaro.org/openembedded/lkft/lkft/rocko/am57xx-evm/lkft/linux-next/441/rpb-console-image-lkft-am57xx-evm-20190115034131-441.rootfs.tar.xz
    TEST_SUITE: ltp
    TEST_PARAM_FILE: ltp_param_file

run:
    steps:
        - df -h
        - pwd
        - cd ./automated/linux/chroot
        - ./download_and_mount.sh ${ARM32_ROOTFS}
        - . new_root/testdef/automated/linux/chroot/${TEST_PARAM_FILE} >> /new_root/run.sh
        - . ./setup_run.sh ${TEST_SUITE} ${TEST_PARAM_FILE}
        - cat /new_root/run.sh
        - chroot /new_root /bin/bash /run.sh
        - /new_root/testdef/automated/utils/send-to-lava.sh /new_root/testdef/automated/linux/${TEST_SUITE}/output/result.txt

parse:
    pattern: "^(?!.+ED)(?P<test_case_id>\\w+)\\s+(?P<result>PASS|FAIL|CONF)\\s+\\d+"
    fixupdict:
        FAIL: fail
        PASS: pass
